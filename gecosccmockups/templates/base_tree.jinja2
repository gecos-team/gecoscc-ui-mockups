{% extends "base_navbar.jinja2" %}

{% block extraheader %}
<!-- Tree CSS -->
<link href="{{request.application_url}}/static/css/fuelux.css" rel="stylesheet">
{% block moreheader %}{% endblock %}
{% endblock %}

{% block inner_content %}
    <!-- left, vertical navbar -->
    <div id="sidebar" class="col-sm-3 bootstrap-admin-col-left fuelux">
        <div id="nav-tree" class="panel panel-default bootstrap-admin-no-table-panel">
            <div class="panel-heading">
                <div class="input-group">
                    <input type="text" class="form-control">
                    <span class="input-group-btn">
                        <button class="btn btn-primary" type="button"><span class="fa fa-search"></span></button>
                    </span>
                </div>
            </div>
            <div id="tree-container">
                <div id="ex-tree" class="tree bootstrap-admin-panel-content bootstrap-admin-no-table-panel-content collapse in"></div>
            </div>
        </div>

        <div id="events" class="panel panel-default bootstrap-admin-no-table-panel">
            <div class="panel-heading">
                <div class="text-muted bootstrap-admin-box-title">Cola y Eventos</div>
                <button id="maximize" class="btn btn-xs btn-default pull-right" title="Maximizar"><span class="fa fa-plus"></span></button>
                <button id="minimize" class="btn btn-xs btn-default pull-right hide" title="Minimizar"><span class="fa fa-minus"></span></button>
                <button class="btn btn-xs btn-default pull-right" title="Refrescar"><span class="fa fa-repeat"></span></button>
            </div>
            <div class="bootstrap-admin-panel-content bootstrap-admin-no-table-panel-content collapse in">
                <div class="long hide row mb10">
                    <div class="col-xs-12 col-sm-8 col-md-6">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Filtra">
                            <div class="input-group-btn">
                                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                    <span class="fa fa-search"></span> <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#"><span class="fa fa-user"></span> Usuarios</a></li>
                                    <li><a href="#"><span class="fa fa-group"></span> Unidades organizativas</a></li>
                                    <li><a href="#"><span class="fa fa-asterisk"></span> Cualquier cosa</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <ul class="list-unstyled">
                    <li class="task">
                        <button class="long hide btn-modal btn btn-info btn-xs"><span class="fa fa-info"></span> Info</button> Cambio 10 - <span class="fa fa-desktop type-icon"></span> <span class="short">Sede Central...</span><span class="long hide">Sede Central, alta de un nuevo puesto de trabajo</span>
                        <span class="badge pull-right">2/4</span><span class="pull-right fa fa-clock-o" title="Chef"></span>
                    </li>
                    <li class="task">
                        <button class="long hide btn-modal btn btn-info btn-xs"><span class="fa fa-info"></span> Info</button> Cambio 11 - <span class="fa fa-group type-icon"></span> <span class="short">Sede Central...</span><span class="long hide">Sede Central, alta de una nueva unidad organizativa</span>
                        <span class="badge pull-right">3/4</span><span class="pull-right fa fa-clock-o" title="Aplicando"></span>
                    </li>
                    <li class="task">
                        <button class="long hide btn-modal btn btn-info btn-xs"><span class="fa fa-info"></span> Info</button> Cambio 12 - <span class="fa fa-user type-icon"></span> <span class="short">Sede Central...</span><span class="long hide">Sede Central, modificación de los datos de un empleado</span>
                        <span class="badge pull-right">2/4</span><span class="pull-right fa fa-clock-o" title="Chef"></span>
                    </li>
                    <li class="task success">
                        <button class="long hide btn-modal btn btn-info btn-xs"><span class="fa fa-info"></span> Info</button> Cambio 13 - <span class="fa fa-group type-icon"></span> <span class="short">Sede Triana...</span><span class="long hide">Sede Central, modificación de una unidad organizativa</span>
                        <span class="badge pull-right">4/4</span><span class="pull-right fa fa-check" title="Finalizado"></span>
                    </li>
                    <li class="task">
                        <button class="long hide btn-modal btn btn-info btn-xs"><span class="fa fa-info"></span> Info</button> Cambio 15 - <span class="fa fa-globe type-icon"></span> <span class="short">Sede Triana...</span><span class="long hide">Sede Central, política, cambio del fondo de pantalla</span>
                        <span class="badge pull-right">1/4</span><span class="pull-right fa fa-clock-o" title="Calculando"></span>
                    </li>
                    <li class="task error">
                        <button class="long hide btn-modal btn btn-info btn-xs"><span class="fa fa-info"></span> Info</button> Cambio 16 - <span class="fa fa-globe type-icon"></span> <span class="short">Sede Central...</span><span class="long hide">Sede Central, política, cambio del tema de iconos</span>
                        <span class="badge pull-right">3/4</span><span class="pull-right fa fa-times" title="Error"></span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div id="viewport-main" class="col-sm-9 col-sm-offset-3">
        <div class="row">
            <div class="navbar navbar-default bootstrap-admin-navbar-thin">
                <ol class="breadcrumb bootstrap-admin-breadcrumb">
                    {% block breadcrumb %}
                    <li class="active">Inicio</li>
                    {% endblock %}
                </ol>
            </div>
        </div>
        {% block main_content %}{% endblock %}
    </div>

    <div id="task-modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Cambio 16 - Sede Central, política, cambio del tema de iconos</h4>
                </div>
                <div class="modal-body">
                    <p class="pull-right">Progreso: <span class="label label-danger">3 de 5</span></p>
                    <label>Equipos</label>
                    <ol>
                        <li>Portátil de Juan [juan-laptop]</li>
                        <li>Portátil de Roberto [bob-laptop]</li>
                        <li>Portátil de Anabel [anabel-laptop]</li>
                        <li>Sobremesa del Departamento de Cuentas [cuentas-desktop]</li>
                        <li>Portátil de Lola [lola-laptop]</li>
                    </ol>

                    <label>Logs</label>
                    <ul class="list-unstyled">
                        <li>09:12 Comenzado preparativos</li>
                        <li>09:12 Copiando fichero en almacenamiento compartido</li>
                        <li><span class="text-success">09:13 Terminados los preparativos</span></li>
                        <li>09:13 Comenzando a aplicar cambios</li>
                        <li><span class="text-success">09:14 Cambio aplicado en juan-laptop</span></li>
                        <li><span class="text-success">09:14 Cambio aplicado en bob-laptop</span></li>
                        <li>
                            <a href="#" class="expand-log"><span class="text-danger"><span class="fa fa-caret-right"></span> 09:14 Error al aplicar cambio en anabel-laptop</span></a>
                            <textarea class="hide form-control" rows="8" disabled>
[  102.713692] ACPI Error: Method parse/execution failed [\_SB_.PCI0.SBRG.EC0_.STBR] (Node ffff880139e936f0), AE_AML_BUFFER_LIMIT (20120913/psparse-536)
[  102.713704] ACPI Error: Method parse/execution failed [\_SB_.PCI0.VGA_.LCDD._BCM] (Node ffff880139e8ace0), AE_AML_BUFFER_LIMIT (20120913/psparse-536)
[  102.713716] ACPI Error: Evaluating _BCM failed (20120913/video-364)
[  102.715864] ACPI Exception: AE_AML_BUFFER_LIMIT, Index (0x0000000000000064) is beyond end of object (20120913/exoparg2-418)
[  102.715875] ACPI Error: Method parse/execution failed [\_SB_.PCI0.SBRG.EC0_.STBR] (Node ffff880139e936f0), AE_AML_BUFFER_LIMIT (20120913/psparse-536)
[  102.715886] ACPI Error: Method parse/execution failed [\_SB_.PCI0.VGA_.LCDD._BCM] (Node ffff880139e8ace0), AE_AML_BUFFER_LIMIT (20120913/psparse-536)
[  102.715898] ACPI Error: Evaluating _BCM failed (20120913/video-364)
[  102.717600] ACPI Exception: AE_AML_BUFFER_LIMIT, Index (0x0000000000000064) is beyond end of object (20120913/exoparg2-418)
[  102.717610] ACPI Error: Method parse/execution failed [\_SB_.PCI0.SBRG.EC0_.STBR] (Node ffff880139e936f0), AE_AML_BUFFER_LIMIT (20120913/psparse-536)
[  102.717621] ACPI Error: Method parse/execution failed [\_SB_.PCI0.VGA_.LCDD._BCM] (Node ffff880139e8ace0), AE_AML_BUFFER_LIMIT (20120913/psparse-536)
[  102.717633] ACPI Error: Evaluating _BCM failed (20120913/video-364)
[  102.894493] ACPI Exception: AE_AML_BUFFER_LIMIT, Index (0x0000000000000064) is beyond end of object (20120913/exoparg2-418)
[  102.894506] ACPI Error: Method parse/execution failed [\_SB_.PCI0.SBRG.EC0_.STBR] (Node ffff880139e936f0), AE_AML_BUFFER_LIMIT (20120913/psparse-536)
[  102.894517] ACPI Error: Method parse/execution failed [\_SB_.PCI0.VGA_.LCDD._BCM] (Node ffff880139e8ace0), AE_AML_BUFFER_LIMIT (20120913/psparse-536)
[  102.894529] ACPI Error: Evaluating _BCM failed (20120913/video-364)
                            </textarea>
                        </li>
                        <li>
                            <a href="#" class="expand-log"><span class="text-danger"><span class="fa fa-caret-right"></span> 09:14 Error: file does not exist</span></a>
                            <textarea class="hide form-control" rows="8" disabled>
[   17.318853] type=1400 audit(1385017506.642:2): apparmor="STATUS" operation="profile_load" name="/{usr/,}bin/ping" pid=566 comm="apparmor_parser"
[   17.336115] type=1400 audit(1385017506.660:3): apparmor="STATUS" operation="profile_load" name="/sbin/klogd" pid=575 comm="apparmor_parser"
[   17.345527] type=1400 audit(1385017506.669:4): apparmor="STATUS" operation="profile_load" name="/sbin/syslog-ng" pid=579 comm="apparmor_parser"
[   17.355109] type=1400 audit(1385017506.679:5): apparmor="STATUS" operation="profile_load" name="/sbin/syslogd" pid=583 comm="apparmor_parser"
[   17.369211] type=1400 audit(1385017506.693:6): apparmor="STATUS" operation="profile_load" name="/usr/lib/apache2/mpm-prefork/apache2" pid=588 comm="apparmor_parser"
[   17.369787] type=1400 audit(1385017506.693:7): apparmor="STATUS" operation="profile_load" name="/usr/lib/apache2/mpm-prefork/apache2//DEFAULT_URI" pid=588 comm="apparmor_parser"
[   17.370338] type=1400 audit(1385017506.694:8): apparmor="STATUS" operation="profile_load" name="/usr/lib/apache2/mpm-prefork/apache2//HANDLING_UNTRUSTED_INPUT" pid=588 comm="apparmor_parser"
[   17.370827] type=1400 audit(1385017506.694:9): apparmor="STATUS" operation="profile_load" name="/usr/lib/apache2/mpm-prefork/apache2//phpsysinfo" pid=588 comm="apparmor_parser"
[   17.380573] type=1400 audit(1385017506.704:10): apparmor="STATUS" operation="profile_load" name="/usr/lib/dovecot/deliver" pid=592 comm="apparmor_parser"
[   17.390493] type=1400 audit(1385017506.714:11): apparmor="STATUS" operation="profile_load" name="/usr/lib/dovecot/dovecot-auth" pid=596 comm="apparmor_parser"
                           </textarea>
                        </li>
                        <li>
                            <a href="#" class="expand-log"><span class="text-danger"><span class="fa fa-caret-right"></span> 09:14 Abortando</span></a>
                            <textarea class="hide form-control" rows="8" disabled>
[   32.575784] cgroup: libvirtd (837) created nested cgroup for controller "memory" which has incomplete hierarchy support. Nested cgroups may change behavior in the future.
[   32.575790] cgroup: "memory" requires setting use_hierarchy to 1 on the root.
                            </textarea>
                        </li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
{% endblock %}

{% block extrajs %}
    <script src="{{request.application_url}}/static/js/datasourceTree.js"></script>
    <script src="{{request.application_url}}/static/js/libs/underscore-1.5.2.min.js"></script>
    <script src="{{request.application_url}}/static/js/libs/backbone-1.1.0.min.js"></script>
    <script src="{{request.application_url}}/static/js/libs/backbone.marionette-1.2.2.min.js"></script>
    <script src="{{request.application_url}}/static/js/libs/TreeModel-0.4.0.min.js"></script>
    <script src="{{request.application_url}}/static/js/app.js"></script>
    <script src="{{request.application_url}}/static/js/tree.js"></script>

    <script>
        $(document).ready(function () {
            // Sidebar heights
            $('#sidebar').height($(window).height() - 131);
            $(window).on('resize', function () {
                // Recalculate sidebar height
                $('#sidebar').height($(window).height() - 131);
            });

            var events = $("#events");
            $("#maximize").click(function (evt) {
                evt.preventDefault();
                $("#maximize").addClass("hide");
                $("#minimize").removeClass("hide");
                $(document.body).append(events);
                events.find(".short").addClass("hide");
                events.find(".long").removeClass("hide");
                events.addClass("maximize");
            });
            $("#minimize").click(function (evt) {
                evt.preventDefault();
                $("#maximize").removeClass("hide");
                $("#minimize").addClass("hide");
                $("#sidebar").append(events);
                events.find(".short").removeClass("hide");
                events.find(".long").addClass("hide");
                events.removeClass("maximize");
            });

            var modal = $("#task-modal").modal({ show: false });
            $("button.btn-modal").click(function (evt) {
                evt.preventDefault();
                modal.modal("show");
            });

            $("#task-modal a.expand-log").click(function (evt) {
                evt.preventDefault();
                var $li = $(evt.target).parents("li"),
                    hidden = $li.find("textarea").is(".hide");

                $li.find("span.fa")
                    .removeClass(hidden ? "fa-caret-right" : "fa-caret-down")
                    .addClass(hidden ? "fa-caret-down" : "fa-caret-right");
                $li.find("textarea").toggleClass("hide");
            });

            App.start();
        });
    </script>
    {% block morejs %}{% endblock %}
{% endblock %}
